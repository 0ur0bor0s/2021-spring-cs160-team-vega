!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("react")):"function"==typeof define&&define.amd?define(["exports","react"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).GraphQLHooks={},e.React)}(this,(function(e,t){"use strict";function r(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var n=r(t);function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function a(e){for(var t=1;arguments.length>t;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){o(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var s=n.default.createContext();s.displayName="ClientContext";var u=function(e){var t=e.name,r=e.type;this.uri=e.uri,this.name=t,this.type=r},c=function(e){return"undefined"!=typeof File&&e instanceof File||"undefined"!=typeof Blob&&e instanceof Blob||e instanceof u},f=function e(t,r,n){var o;void 0===r&&(r=""),void 0===n&&(n=c);var i=new Map;function a(e,t){var r=i.get(t);r?r.push.apply(r,e):i.set(t,e)}if(n(t))o=null,a([r],t);else{var s=r?r+".":"";if("undefined"!=typeof FileList&&t instanceof FileList)o=Array.prototype.map.call(t,(function(e,t){return a([""+s+t],e),null}));else if(Array.isArray(t))o=t.map((function(t,r){var o=e(t,""+s+r,n);return o.files.forEach(a),o.clone}));else if(t&&t.constructor===Object)for(var u in o={},t){var f=e(t[u],""+s+u,n);f.files.forEach(a),o[u]=f.clone}else o=t}return{clone:o,files:i}},l=function(e){return c(e)||null!==e&&"object"==typeof e&&"function"==typeof e.pipe},h=function(){function e(e){if(void 0===e&&(e={}),!e.url)throw Error("GraphQLClient: config.url is required");if(e.fetch&&"function"!=typeof e.fetch)throw Error("GraphQLClient: config.fetch must be a function");if(("undefined"!=typeof window&&void 0!==window.document&&void 0!==window.document.createElement||e.ssrMode)&&!e.fetch&&!fetch)throw Error("GraphQLClient: fetch must be polyfilled or passed in new GraphQLClient({ fetch })");if(e.ssrMode&&!e.cache)throw Error("GraphQLClient: config.cache is required when in ssrMode");this.cache=e.cache,this.headers=e.headers||{},this.ssrMode=e.ssrMode,this.ssrPromises=[],this.url=e.url,this.fetch=e.fetch||"undefined"!=typeof fetch&&fetch&&fetch.bind(),this.fetchOptions=e.fetchOptions||{},this.FormData=e.FormData||("undefined"!=typeof FormData?FormData:void 0),this.logErrors=void 0===e.logErrors||e.logErrors,this.onError=e.onError,this.useGETForQueries=!0===e.useGETForQueries,this.subscriptionClient=e.subscriptionClient}var t=e.prototype;return t.setHeader=function(e,t){return this.headers[e]=t,this},t.setHeaders=function(e){return this.headers=e,this},t.removeHeader=function(e){return delete this.headers[e],this},t.logErrorResult=function(e){var t=e.result,r=e.operation;console.error("GraphQL Hooks Error"),console.groupCollapsed("---\x3e Full Error Details"),console.groupCollapsed("Operation:"),console.log(r),console.groupEnd();var n=t.error;n&&(n.fetchError&&(console.groupCollapsed("FETCH ERROR:"),console.log(n.fetchError),console.groupEnd()),n.httpError&&(console.groupCollapsed("HTTP ERROR:"),console.log(n.httpError),console.groupEnd()),n.graphQLErrors&&n.graphQLErrors.length>0&&(console.groupCollapsed("GRAPHQL ERROR:"),n.graphQLErrors.forEach((function(e){return console.log(e)})),console.groupEnd())),console.groupEnd()},t.generateResult=function(e){var t=e.fetchError,r=e.httpError,n=e.graphQLErrors,o=e.data;return!!(n&&n.length>0||t||r)?{data:o,error:{fetchError:t,httpError:r,graphQLErrors:n}}:{data:o}},t.getCacheKey=function(e,t){return void 0===t&&(t={}),{operation:e,fetchOptions:a(a({},this.fetchOptions),t.fetchOptionsOverrides)}},t.getCache=function(e){var t=this.cache?this.cache.get(e):null;if(t)return t},t.saveCache=function(e,t){this.cache&&this.cache.set(e,t)},t.getFetchOptions=function(e,t){void 0===t&&(t={});var r=a(a({method:"POST",headers:a({},this.headers)},this.fetchOptions),t);if("GET"===r.method)return r;var n=f(e,"",l),o=n.files,i=JSON.stringify(n.clone);if(o.size){if(!this.FormData)throw Error("GraphQLClient: FormData must be polyfilled or passed in new GraphQLClient({ FormData })");var s=new this.FormData;s.append("operations",i);var u={},c=0;o.forEach((function(e){u[++c]=e})),s.append("map",JSON.stringify(u)),c=0,o.forEach((function(e,t){s.append(""+ ++c,t,t.name)})),r.body=s}else r.headers["Content-Type"]="application/json",r.body=i;return r},t.request=function(e,t){var r=this;void 0===t&&(t={});var n=this.url;"GET"===this.getFetchOptions(e,t.fetchOptionsOverrides).method&&(n=n+"?"+Object.entries(e).filter((function(e){return!!e[1]})).map((function(e){var t=e[0],r=e[1];return"variables"===t&&(r=JSON.stringify(r)),t+"="+encodeURIComponent(r)})).join("&"));return this.fetch(n,this.getFetchOptions(e,t.fetchOptionsOverrides)).then((function(e){return e.ok?e.json().then((function(e){return r.generateResult({graphQLErrors:e.errors,data:e.data})})):e.text().then((function(t){return r.generateResult({httpError:{status:e.status,statusText:e.statusText,body:t}})}))})).catch((function(e){return r.generateResult({fetchError:e})})).then((function(t){return t.error&&(r.logErrors&&r.logErrorResult({result:t,operation:e}),r.onError&&r.onError({result:t,operation:e})),t}))},t.createSubscription=function(e){if(!this.subscriptionClient)throw Error("No SubscriptionClient! Please set in the constructor.");return this.subscriptionClient.request(e)},e}(),p=Object.prototype.hasOwnProperty;function d(e,t,r){for(r of e.keys())if(g(r,t))return r}function g(e,t){var r,n,o;if(e===t)return!0;if(e&&t&&(r=e.constructor)===t.constructor){if(r===Date)return e.getTime()===t.getTime();if(r===RegExp)return""+e==""+t;if(r===Array){if((n=e.length)===t.length)for(;n--&&g(e[n],t[n]););return-1===n}if(r===Set){if(e.size!==t.size)return!1;for(n of e){if((o=n)&&"object"==typeof o&&!(o=d(t,o)))return!1;if(!t.has(o))return!1}return!0}if(r===Map){if(e.size!==t.size)return!1;for(n of e){if((o=n[0])&&"object"==typeof o&&!(o=d(t,o)))return!1;if(!g(n[1],t.get(o)))return!1}return!0}if(r===ArrayBuffer)e=new Uint8Array(e),t=new Uint8Array(t);else if(r===DataView){if((n=e.byteLength)===t.byteLength)for(;n--&&e.getInt8(n)===t.getInt8(n););return-1===n}if(ArrayBuffer.isView(e)){if((n=e.byteLength)===t.byteLength)for(;n--&&e[n]===t[n];);return-1===n}if(!r||"object"==typeof e){for(r in n=0,e){if(p.call(e,r)&&++n&&!p.call(t,r))return!1;if(!(r in t)||!g(e[r],t[r]))return!1}return Object.keys(t).length===n}}return e!=e&&t!=t}var y="RESET_STATE",v="LOADING",E="CACHE_HIT",b="REQUEST_RESULT";function O(e,t){switch(t.type){case y:return t.initialState;case v:return e.error?a(a({},t.initialState),{},{data:e.data,loading:!0}):e.loading?e:a(a({},e),{},{loading:!0});case E:return e.cacheHit&&!t.resetState?e:a(a({},t.result),{},{cacheHit:!0,loading:!1});case b:return a(a({},t.result),{},{data:e.data&&t.result.data&&t.updateData?t.updateData(e.data,t.result.data):t.result.data,cacheHit:!1,loading:!1});default:return e}}function m(e,t){if(void 0===t&&(t={}),"string"!=typeof e)throw Error("Your query must be a string. If you are using the `gql` template literal from graphql-tag, remove it from your query.");var r=n.default.useContext(s),o=t.client||r,i=n.default.useRef(!0),u=n.default.useRef(null),c={query:e,variables:t.variables,operationName:t.operationName,persisted:t.persisted};(t.persisted||o.useGETForQueries&&!t.isMutation)&&(t.fetchOptionsOverrides=a(a({},t.fetchOptionsOverrides),{},{method:"GET"}));var f=o.getCacheKey(c,t),l=t.isMutation||t.isManual,h=t.skipCache||!o.cache?null:o.cache.get(f),p=a(a({},h),{},{cacheHit:!!h,loading:!l&&!h}),d=n.default.useReducer(O,p),m=d[0],C=d[1],w=JSON.stringify(f);n.default.useEffect((function(){t.updateData||C({type:y,initialState:p})}),[w]),n.default.useEffect((function(){return i.current=!0,function(){i.current=!1}}),[]);var R,D,j,S=(R=function(e){if(!i.current)return Promise.resolve();var r=a(a({},t),e),n=a(a({},c),{},{variables:r.variables,operationName:r.operationName}),s=o.getCacheKey(n,r);u.current=s;var f=r.skipCache?null:o.getCache(s);return f?(C({type:E,result:f,resetState:w!==JSON.stringify(m.cacheKey)}),Promise.resolve(f)):(C({type:v,initialState:p}),o.request(n,r).then((function(e){if(r.updateData&&"function"!=typeof r.updateData)throw Error("options.updateData must be a function");var t=a({},e);if(r.useCache&&(t.useCache=!0,t.cacheKey=s,o.ssrMode)){var n={error:t.error,data:r.updateData?r.updateData(m.data,t.data):t.data};o.saveCache(s,n)}return i.current&&s===u.current&&C({type:b,updateData:r.updateData,result:t}),e})))},D=[o,t,c],j=n.default.useRef(),g(D,j.current)||(j.current=D),n.default.useCallback(R,j.current));n.default.useEffect((function(){m.useCache&&o.saveCache(m.cacheKey,m)}),[o,m]);return[S,m,function(e){return void 0===e&&(e={}),C({type:y,initialState:a(a({},p),e)})}]}var C={useCache:!0};e.ClientContext=s,e.GraphQLClient=h,e.useClientRequest=m,e.useManualQuery=function(e,t){return m(e,a({useCache:!0,isManual:!0},t))},e.useMutation=function(e,t){return m(e,a({isMutation:!0},t))},e.useQuery=function(e,t){void 0===t&&(t={});var r=a(a({},C),t),o=n.default.useContext(s),i=t.client||o,u=n.default.useState(!1),c=u[0],f=u[1],l=m(e,r),h=l[0],p=l[1];if(i.ssrMode&&!1!==t.ssr&&!c&&!t.skipCache){if(!p.data&&!p.error){var d=h();i.ssrPromises.push(d)}f(!0)}var g=JSON.stringify(r);return n.default.useEffect((function(){h()}),[e,g]),a(a({},p),{},{refetch:n.default.useCallback((function(e){return void 0===e&&(e={}),h(a({skipCache:!0,updateData:function(e,t){return t}},e))}),[h])})},e.useSubscription=function(e,r){var n=t.useRef(r);n.current=r;var o=t.useContext(s),i=e.client||o,a={query:e.query,variables:e.variables};t.useEffect((function(){var e=i.createSubscription(a).subscribe({next:function(e){n.current(e)},error:function(){e.unsubscribe()},complete:function(){e.unsubscribe()}});return function(){e.unsubscribe()}}),[])},Object.defineProperty(e,"__esModule",{value:!0})}));
